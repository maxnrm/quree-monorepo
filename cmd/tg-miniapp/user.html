<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scan QR</title>
</head>

<body>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script>
        let tg = window.Telegram.WebApp; //получаем объект webapp телеграма 

        tg.showScanQrPopup({ text: "Сканирование..." }, function () {
            return false
        });

        tg.onEvent("qrTextReceived", async function({ data }) {
            let sendObject = {}

            sendObject.pass = data.split(",")[0]
            sendObject.city = data.split(",")[1]
            sendObject.chat_id = String(tg.initDataUnsafe.user.id)

            if (sendObject.pass != "loc") {
                return
            }


            result = await fetch("/api/user/add_city", {
                method: "POST",
                body: JSON.stringify(sendObject)
            })

            tg.close()
            tg.closeScanQrPopup()
        })

        tg.ready()

    </script>
</body>

</html>